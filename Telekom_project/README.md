# Прогнозирование оттока клиентов

## Описание проекта:
Оператор связи «Ниединогоразрыва.ком» хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

Оператор предоставляет два основных типа услуг: 

1. Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно.
2. Интернет. Подключение может быть двух типов: через телефонную линию (DSL*,* от англ. *digital subscriber line*, «цифровая абонентская линия») или оптоволоконный кабель (*Fiber optic*).  

Также доступны такие услуги:

- Интернет-безопасность: антивирус (*DeviceProtection*) и блокировка небезопасных сайтов (*OnlineSecurity*);
- Выделенная линия технической поддержки (*TechSupport*);
- Облачное хранилище файлов для резервного копирования данных (*OnlineBackup*);
- Стриминговое телевидение (*StreamingTV*) и каталог фильмов (*StreamingMovies*).

За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека. Информация о договорах актуальна на 1 февраля 2020.


Данные состоят из файлов, полученных из разных источников:

- `contract_new.csv` — информация о договоре;
- `personal_new.csv` — персональные данные клиента;
- `internet_new.csv` — информация об интернет-услугах;
- `phone_new.csv` — информация об услугах телефонии.

**Описание полей данных:**
- `BeginDate` – дата начала пользования услугами;
- `EndDate` – дата окончания пользования услугами;
- `Type` – тип оплаты: ежемесячный, годовой и тд;
- `PaperlessBilling` – безналичный расчет;
- `PaymentMethod` – способ оплаты;
- `MonthlyCharges` – ежемесячные траты на услуги;
- `TotalCharges` – всего потрачено денег на услуги;
- `Dependents` – наличие иждивенцев;
- `Senior Citizen` – наличие пенсионного статуса по возрасту;
- `Partner` – наличие супруга(и);
- `MultipleLines` – наличие возможности ведения параллельных линий во время звонка.

Во всех файлах столбец customerID содержит код клиента. 

<br>

## Цель исследования:

Построить модель, способную спрогнозировать отток клиентов. Основная метрика - `AUC-ROC`, дополнительная метрика - `Accuracy`. Пороговое значение основной метрики >= 0.85.

<br>

## Навыки и инструменты:
`Машинное обучение`
`Классификация`
`Предобработка данных`
`EDA` 
`Проверка статистических гипотез`
`Pandas` 
`Scikit-learn`
`Matplotlib` 
`Seaborn`
`Pipeline`
`GridSearchCV`
`phik`
`make_column_transformer`
`OneHotEncoder`
`OrdinalEncoder`
`StandardScaler`
`LogisticRegression`
`RandomForestClassifier`
`CatBoostClassifier`
`LGBMClassifier`

<br>

## Проделанная работа:
- Был проведен предварительный анализ данных.
- Произведен исследовательский анализ и составлен портрет пользователя, который вероятно покинет компанию.
- Удалены признаки, не несущие полезной для задачи информации. 
- Обработаны категориальные признаки и проведена стандартизация численных признаков с использованием make_column_transformer.
- Проведен выбор модели МО, подбор гиперпараметров с помощью GridSearchCV.
- Построена модель, способная спрогнозировать отток клиентов.

<br>

## Вывод:

**1. Предобработка данных**

  В нашем распоряжении оказались данные по 7043 клиентам телеком компании, из которых 6361 пользовались услугами телефонии и 5517 интернет-услугами. Данные описывались 20-ю признаками.
  
  В ходе предобработки были решены следующие проблемы:
  
  - В данных отсутствовал целевой признак. Целевой признак `exited` был сформирован на основе столбца `EndDate` (дата окончания пользования услугами). Наличие даты соответствует уходу клиента, если стоит значение "No" - клиент остался.
  - Таким образом модель будет предсказывать значение `1`, если клиент собирается покинуть компанию или `0`, если нет. Перед нами задача бинарной классификации.
  
  
  - В поле с общими суммами трат обнаружились неявные пропуски. Неявные пропуски заменили на 0, так как все пользователи с пропусками в этом поле начали обслуживание в день выгрузки датасета.
  
  
  - После объединения исходных таблиц в один датасет появились пропущенные значения. Это произошло по причине, что не все пользователи пользовались и услугами интернета и услугами телефонии.
  - Пропуски в услугах были заменены на "No". Исходные таблицы соединены по столбцу идентификатору пользователя, который есть во всех таблицах и одной записи customer_id соответствует одна строка в каждой таблице.


<br>

**2. Исследовательский анализ данных**

На этом этапе был составлен портрет пользователя, который может покинуть компанию в ближайшее время:
- ежемесячный платеж от 84 долларов и выше (ушедшие пользователи пользуются более дорогими тарифами),
- пользуется предоплатными типами договора (оплата раз в год или раз в два года),
- пользуется автоматическими способами оплаты (Bank transfer или Credit card),
- был с компанией 1,5 - 4,5 года от начала действия договора.

  <br>

  <img width="800" alt="Screenshot_70" src="https://github.com/elena-iliushina/Portfolio/assets/133641038/4230a64f-9736-40e6-859b-d9020ac68d93">
  <img width="800" alt="Screenshot_72" src="https://github.com/elena-iliushina/Portfolio/assets/133641038/ea68383b-a5d6-46bd-8033-adb8293963f4">
  <img width="800" alt="Screenshot_73" src="https://github.com/elena-iliushina/Portfolio/assets/133641038/06378842-8422-40ec-8af4-db2a4c162076">


  <br>

<br>

**3. Обучение моделей**

  В исследовании участвовали четыре различные алгоритма классификации: Логистическая регрессия (Logistic Regression), Случайный лес (Random Forest), Градиентный бустинг (Cat Boost Classifier),
  Стохастический градиентный бустинг (LGBM Classifier). У каждой модели менялись гиперпараметры, чтобы добиться наиболее высокой оценки качества.
  
  
  Итоговый список признаков для обучения моделей:
  - `type` - тип оплаты: ежемесячный, годовой и тд,
  - `paperless_billing` - безналичный расчет (Да/Нет),
  - `payment_method` - способ оплаты,
  - `monthly_charges` - ежемесячные траты на услуги,
  - `total_days` - длительность пользования клиентом услугами компании в днях,
  - `online_security` - блокировка небезопасных сайтов (факт наличия услуги),
  - `online_backup` - облачное хранилище файлов для резервного копирования данных (факт наличия услуги),
  - `device_protection` - антивирус (факт наличия услуги),
  - `tech_support` - выделенная линия технической поддержки (факт наличия услуги),
  - `senior_citizen` - наличие пенсионного статуса по возрасту,
  - `partner` - наличие супруга(и),
  - `multiple_lines` - наличие возможности ведения параллельных линий во время звонка.
  
  Целевой признак:
  - `exited` - факт ухода клиента из компании.
  
  
  Перед началом обучения:
  - исходный датафрейм был разделён на две выборки: обучающую (75%) и тестовую (25%),
  - для Logistic Regression количественные признаки были масштабированы, а категориальные закодированы методом прямого кодирования (One-Hot Encoding) с использованием pipeline,
  - для Random Forest количественные признаки были масштабированы, а категориальные закодированы методом OrdinalEncoder с использованием pipeline,
  - для Cat Boost Classifier и LGBM Classifier категориальные признаки были закодированы с использованием внутренних кодировщиков.
  
  
  Сводная таблица исследованных моделей и их метрики на кросс-валидации:
  
  <br>
  
  ![1](https://github.com/RamJacky/DS_Portfolio/blob/main/Telekom_project/attachments/1.png)

  <br>

**4. Тестирование лучшей модели**

  По итогам исследования был сделан вывод, что для прогнозирования ухода клиента из компании наиболее подходящей моделью является модель, построенная на алгоритме Градиентного бустинга (Cat Boost Classifier) с глубиной (depth) = 2,
  количеством итераций (iterations) = 1500 и скоростью обучения (learning_rate) = 0.3.

  <br>

  ![2](https://github.com/RamJacky/DS_Portfolio/blob/main/Telekom_project/attachments/2.png)

  <br>

  Итоговое значение качества модели на тестовой выборке AUC-ROC = 0.93, Accuracy = 0.94. Модель характеризуется высоким показателем полноты = 0.68 (min = 0, max = 1), поэтому она с высокой вероятностью предскажет уход клиента из компании. 
  С точки зрения бизнеса полученная модель поможет маркетологам лучше определять клиентов, которые могут уйти в ближайшее время. По матрице ошибок видим, что модель верно определяет положительный класс примерно в двух случаях из трех.

  <br>

  ![3](https://github.com/RamJacky/DS_Portfolio/blob/main/Telekom_project/attachments/3.png)
  ![4](https://github.com/RamJacky/DS_Portfolio/blob/main/Telekom_project/attachments/4.png)

  <br>


  Наибольший вклад в обучение модели вносят признаки: количество дней действия договора, ежемесячные траты и тип оплаты. Меньший, но также значимый вклад вносят признаки: метод оплаты, наличие супруга(и), наличие услуг антивируса, резервного копирования данных и параллельных линий.
